<!-- title-start -->
### Групповые действия в гридах awz.smartbag
<!-- title-start -->

<!-- main-start -->
Действия организованы на бизнес процессах, через системный смарт. 
Для использования механизма следует создать смарт-процесс с полями:

| Опция                                                   | Значение          |
|---------------------------------------------------------|-------------------|
| Название смарт процесса                                 | Умный смарт       |
| Использовать в смарт-процессе свои стадии и канбан      | да                |
| Использовать в смарт-процессе роботы и триггеры         | да                |
| Использовать в смарт-процессе дизайнер бизнес-процессов | да                |
| Привязка к другим инструментам                          | Элементы CRM      |



| Свойство              | Тип                                     | Код      |
|-----------------------|-----------------------------------------|----------|
| Действие              | Список                                  | CONTROLS |
| Выбранные элементы    | Целое число, множественное              | ELEMENTS |
| Сущности CRM          | Привязка к элементам CRM, множественное | ITEMS    |
| Доп. параметры        | Список                                  | PARAMS   |
| Результат выполнения  | Строка                                  | RESULT   |

### Выбранные элементы

В данное поле будут записываться выбранные в гриде идентификаторы элементов

### Сущности CRM

В данное свойство записываются выбранные сущности CRM если выбор доступен в действии

### Результат выполнения

Сюда записывается результат выполнения БП. 
После запуска действия грид сделает 5 опросов раз в 5 секунд за результатом и заберет данный html. 
Сюда можно добавить, например, ссылку на сгенерированный в результате БП документ.

### Доп. параметры

Можно указать дополнительный параметр(ы) выбора для сконфигурированного действия

### Доступные действия для грида

Сюда записываем название и параметры действия в специальном костыльном формате через 2 вертикальных слеша

**Формат записи действия:** 

```
параметр1||параметр2||параметр3||параметр4||параметр5||параметр6
```

![](https://zahalski.dev/images/modules/keis02/001.png)

| код       | название                                  | описание                                                                                                                                                                                                                                                               |
|-----------|-------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| параметр1 | Название действия                         | Название действия для отображения в списке действий                                                                                                                                                                                                                    |
| параметр2 | Разрешить выбирать все элементы           | Y - разрешено, другое значение - нет                                                                                                                                                                                                                                   |
| параметр3 | Разрешенные пользователи                  | Ид пользователей которым разрешено действие, если несколько, то через запятую. <br/>Пустое значение = все пользователи.                                                                                                                                                |
| параметр4 | Элемент(ы) CRM                            | Позволяет выбрать элементы crm из разрешенных сущностей, если несколько, то через запятую. <br/>Пустое значение = отключить поле. <br/>Доступны ([дока битрикса](https://dev.1c-bitrix.ru/rest_help/js_library/dialog/selectCRM.php)): lead, contact, company, deal, quote |
| параметр5 | Доступные доп параметры выбора в действии | Перечислить через запятую ид полей (ид можно глянуть в просмотре кода в браузере). Если несколько, то через запятую. Пустое значение = отключить поле.                                                                                                                 |
| параметр6 | Идентификатор грида                       | Пустое значение = все гриды. Может быть только одиночным. Разрешено использование регулярных выражений.                                                                                                                                    |                                

Разрешеные символы в регулярке названия грида

```
0-9a-z_*[]{},()|

// * - будет заменено на .*
// название грида будет приведено в нижний регистр перед применением регулярки
```

после изменения параметров в гриде необходимо сбросить кеш полей (кнопка возле фильтра в гриде)

## Логика работы

После выбора элементов и дополнительных параметров в наш **Умный смарт** будет записан элемент на клиенте (от пользователя использующего грид)

![](https://zahalski.dev/images/modules/keis02/003.png)

Для организации автоматизации соответственно вешаем БП на наш элемент смарт процесса.

Чтобы вывести сообщение об успехе можно использовать любой свой html, для ссылок на crm-сущности можно использовать класс для ссылки .open-smart

```html
отчет добавлен в сделку <a href="#" class="open-smart" data-id="{=A30714_91550_27456_60555:Value}" data-ent="company">{=A79182_84572_8297_92020:TITLE}</a>
```

```html
отчет добавлен в сделку <a href="#" class="open-smart" data-id="CO_58" data-ent="company">test</a>
```

![](https://zahalski.dev/images/modules/keis02/002.png)

<!-- main-end -->